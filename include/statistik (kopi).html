
<ul class="nav nav-tabs" id="myTab">
  <li><a href="#statistik-kort" data-toggle="tab">Fund på kort</a></li>
  <li><a href="#statistik-graf" data-toggle="tab">Grafik</a></li>
</ul>

<style type="text/css">
.piechart {
	float: left;
	clear: none;
	margin: 10px;
}
</style>

<script type="text/javascript">
/*
var map;
var artsgruppe='';
var hold='*';
var markers = [];
var resultat_json;
var holdArtsgrupper=[];

function initMap() {
	map = Geo.googleMap('statistik-map', window.Blitz.lat, window.Blitz.long, 16);
	map.setMapTypeId(google.maps.MapTypeId.SATELLITE);
}
function evalFund(fund) {
	if (hold!='*') {
		if (fund.finder_hold!=hold) return false;
	}
	if (artsgruppe!='') {
		if (fund.artsgruppe_dk!=artsgruppe) return false;
	}
	return true;
}
function placerFund() {
	var url='ajax/event_resultat.php';
	url+='?event_id='+Blitz.event_id;
	$.ajax({
		url : url,
		dataType : 'json',
		cache : false,
		success : function(json) {
			for (var i=0;i<json.fund.length;i++) {
				var fund=json.fund[i];
				//console.log(fund);
				if (evalFund(fund)) {
					var icon=($.inArray(fund.artsgruppe_dk, artsgruppe_icons)) ?	
						artsgruppe_icons[fund.artsgruppe_dk] :
						artsgruppe_default_icon;
	
					if (icon==null) icon=artsgruppe_default_icon;
					var marker = new google.maps.Marker({
						position: new google.maps.LatLng(fund.lat, fund.lng),
						icon: icon,
						LNR: fund.LNR,
						title: "Klik for at se alle oplysninger om fundet",
						map: map
					});

					google.maps.event.addListener(marker, 'click', function() {
						window.Blitz.showFund(this.LNR);
					});
		
				}
			}
		}
	});
}
function initHoldSelect() {
	var url='ajax/event_hold.php';
	url+='?event_id='+Blitz.event_id;
	$.ajax({
		url : url,
		dataType : 'json',
		cache : false,
		success : function(json) {
			$("#select-hold").append('<option value="*">[ Alle hold ]</option>');
			for (var i=0;i<json.hold.length;i++) {
				var caption=(json.hold[i]!='') ? json.hold[i] : '< ikke angivet >';
				$("#select-hold").append('<option value="'+json.hold[i]+'">'+caption+'</option>');
			}
		}
	});
}
function initArtsgruppeSelect() {
	/*
	var url='proxy.php?url=http://allearter-databasen.dk/api/?get=artsgrupper&query=';
	$.ajax({
		url: url,
		dataType: 'json',
		success : function (json) {
			var artsgrupper=[];
			for (var i=0;i<json.allearter.length;i++) {
				artsgrupper.push(decodeURIComponent(escape(json.allearter[i].Artsgruppe_dk)));
			}
			artsgrupper.sort();
			$("#select-artsgruppe").append('<option value="">[ Alle artsgrupper ]</option>');
			for (var i=0;i<artsgrupper.length;i++) {
				$("#select-artsgruppe").append('<option value="'+artsgrupper[i]+'">'+artsgrupper[i]+'</option>');
			}
		}
	});
	*/
/*
	var url='ajax/fund_artsgrupper.php';
	$.ajax({
		url: url,
		dataType: 'json',
		success : function (json) {
			$("#select-artsgruppe").append('<option value="">[ Alle artsgrupper ]</option>');
			for (var i=0;i<json.artsgrupper.length;i++) {
				$("#select-artsgruppe").append('<option value="'+json.artsgrupper[i]+'">'+json.artsgrupper[i]+'</option>');
			}
		}
	});
	$("#select-artsgruppe").click(function() {
		if ($(this).val()!=artsgruppe) {
			artsgruppe=$(this).val();
			initMap();
			placerFund();
		}
	});
	$("#select-hold").click(function() {
		if ($(this).val()!=hold) {
			hold=$(this).val();
			initMap();
			placerFund();
		}
	});
}
function chartHoldArtsgrupper(id, hold, artsgrupper) {
	var colors = [];
	var data = new google.visualization.DataTable();
	data.addColumn('string', 'Artsgruppe');
	data.addColumn('number', 'Antal fund');
	for (var i=0;i<artsgrupper.length;i++) {
		var artsgruppe=artsgrupper[i];
		data.addRow([artsgruppe, artsgrupper[artsgruppe].count]);
		switch (artsgrupper[artsgruppe].rige) {
			case 'Dyreriget' :
				colors.push("#3366cc");
				break;
			case 'Planteriget' :
				colors.push("#109618");
				break;
			case 'Svamperiget' :
				colors.push("#ff9900");
				break;
			default : 
				break;
		}
	}
	var options = {
		title: 'Hold '+hold,
		width: 440,
        height: 300,
		colors : colors,
		'chartArea': {left:10,top:50,width:440},
		backgroundColor: { stroke: "#ebebeb", strokeWidth: 1, fill: "#fff" }
    };
    var chart = new google.visualization.PieChart(document.getElementById(id));
    chart.draw(data, options)
}

function chartHoldRiger(holdriger) {
	var data = new google.visualization.DataTable();
	data.addColumn('string', 'Hold');
	data.addColumn('number', 'Dyreriget');
	data.addColumn('number', 'Planteriget');
	data.addColumn('number', 'Svamperiget');

	for (var i=0;i<holdriger.length;i++) {
		var item=holdriger[i];
 		data.addRow([item.hold, item.dyreriget, item.planteriget, item.svamperiget]);
	}
	new google.visualization.BarChart(document.getElementById('bar-riger')).
		draw(data,
        {title:"Holdenes fund fordelt på riger",
		isStacked : true,
		colors: ["#3366cc","#109618","#ff9900"],
		width: 1000, 
		height: 400,
		'chartArea': {left:10,top:50,width:900},
        vAxis: {title: "Hold"},
        hAxis: {title: "Antal"}}
	);
/*
{"#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac","#b77322","#16d620","#b91383","#f4359e","#9c5935","#a9c413","#2a778d","#668d1c","#bea413","#0c5922","#743411"}
*/
/*
}

function parseHoldArtsgrupper(json) {
	var hold=[];
	for (i=0;i<json.fund.length;i++) {
		var fund=json.fund[i];
		if ((fund.finder_hold!='') && ($.inArray(fund.finder_hold, hold)<0)) {
			hold.push(fund.finder_hold);
		}
	}
	for (var i=0;i<hold.length;i++) {
		var holdnavn=hold[i];
		var artsgrupper=new Array();//[];
		for (count=0;count<json.fund.length;count++) {
			var fund=json.fund[count];
			if ((fund.finder_hold==holdnavn) && (fund.artsgruppe_dk!='')) {
				if ($.inArray(fund.artsgruppe_dk, artsgrupper)==-1) {
					artsgrupper.push(fund.artsgruppe_dk);
					var info = new Object();
					info.count=1;
					info.rige=fund.rige_dk;
					artsgrupper[fund.artsgruppe_dk]=info;
				} else {
					artsgrupper[fund.artsgruppe_dk].count++;
				}
			}
		}
		artsgrupper.sort(function(a, b) {
			return (artsgrupper[a].count>artsgrupper[b].count) ? -1 : 1;
		});
		var id='chart'+i;
		$("#hold-artsgrupper").append('<div class="piechart" id="'+id+'"></div>');
		chartHoldArtsgrupper(id, holdnavn, artsgrupper);
	}
}
function parseHoldRiger(json) {
	var hold=[];
	for (i=0;i<json.fund.length;i++) {
		var fund=json.fund[i];
		if ((fund.finder_hold!='') && ($.inArray(fund.finder_hold, hold)<0)) {
			hold.push(fund.finder_hold);
		}
	}
	var holdriger=[];
	for (var i=0;i<hold.length;i++) {
		var holdnavn=hold[i];
		var rige=new Object();
		rige.hold=holdnavn;
		rige.dyreriget=0;
		rige.planteriget=0;
		rige.protozoriget=0;
		rige.chromista=0;
		rige.svamperiget=0;
		for (count=0;count<json.fund.length;count++) {
			var fund=json.fund[count];
			if ((fund.finder_hold==holdnavn) && (fund.rige_dk!='')) {
				switch (fund.rige_dk) {
					case 'Dyreriget' : 
						rige.dyreriget++;
						break;
					case 'Planteriget' : 
						rige.planteriget++;
						break;
					case 'Svamperiget' : 
						rige.svamperiget++;
						break;
					default :
						break;
				}
			}
		}
		//console.log(rige);
		holdriger.push(rige);
	}
	$("#hold-riger").append('<div id="bar-riger"></div>');
	chartHoldRiger(holdriger);
}
function getHoldArtsgrupper() {
	var url='ajax/event_resultat.php';
	url+='?event_id='+Blitz.event_id;
	$.ajax({
		url : url,
		dataType : 'json',
		cache : false,
		success : function(json) {
			parseHoldRiger(json);
			parseHoldArtsgrupper(json);
		}
	});						
}
function initPiktogrammer() {
	var div='<div style="float:left;clear: none; margin-right:20px;wodth:200px;">';
	var html='<br>'+div;
	var count=1;
	for (var key in artsgruppe_icons) {
		if (artsgruppe_icons[key]!=artsgruppe_default_icon) {
			html+='<img src="'+artsgruppe_icons[key]+'">';
			html+='&nbsp;';
			html+=key;
			html+='<br>';
			count++;
			if (count>=3) {
				html+='</div>'+div;
				count=1;
			}
		}
	}
	html+='<img src="'+artsgruppe_default_icon+'">&nbsp;Øvrige';
	html+='</div>';
	$('#piktogrammer').html(html);
}
$(document).ready(function() {
	$('#myTab a:first').tab('show');
	initMap();
	placerFund();
	initArtsgruppeSelect();
	initHoldSelect();
	getHoldArtsgrupper();
	initPiktogrammer();
});
*/
</script>

<div class="tab-content">

  <div class="tab-pane active" id="statistik-kort">
	<form class="form-inline">
		<label>Artsgruppe</label>&nbsp;
		<select id="select-artsgruppe"></select>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<label>Hold</label>&nbsp;
		<select id="select-hold"></select>
	</form>
    <div id="statistik-map" style="width:1047px;height:700px;border:1px solid silver;"></div>
	<div id="piktogrammer"></div>
  </div>

  <div class="tab-pane" id="statistik-graf" style="XXoverflow:hidden;">
	<div id="hold-riger"></div>
	<div id="hold-artsgrupper"></div>
  </div>

</div>

